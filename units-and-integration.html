
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Units and Integration</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=720ed60b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-ZBXC3EFGGJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'units-and-integration';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt="None - Home"/>
    <script>document.write(`<img src="_static/logo.svg" class="logo__image only-dark" alt="None - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Using scipy.integrate
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--units-and-integration" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--units-and-integration/issues/new?title=Issue%20on%20page%20%2Funits-and-integration.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using scipy.integrate</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-scipy-integrate">
<h1>Using <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code><a class="headerlink" href="#using-scipy-integrate" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p>Zach Pace, Lia Corrales, Stephanie T. Douglas</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>perform numerical integration in the <code class="docutils literal notranslate"><span class="pre">astropy</span></code> and scientific python context</p></li>
<li><p>trapezoidal approximation</p></li>
<li><p>gaussian quadrature</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>’s built-in black-body curves</p></li>
<li><p>understand how <code class="docutils literal notranslate"><span class="pre">astropy</span></code>’s units interact with one another</p></li>
<li><p>define a Python class</p></li>
<li><p>how the <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method works</p></li>
<li><p>add <span class="math notranslate nohighlight">\(\LaTeX\)</span> labels to <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> figures using the <code class="docutils literal notranslate"><span class="pre">latex_inline</span></code> formatter</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>modeling, units, synphot, OOP, LaTeX, astrostatistics, matplotlib, units, physics</p>
</section>
<section id="companion-content">
<h2>Companion Content<a class="headerlink" href="#companion-content" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://synphot.readthedocs.io/en/latest/">http://synphot.readthedocs.io/en/latest/</a></p></li>
<li><p><a class="reference external" href="https://learn.astropy.org/tutorials/quantities.html">Using Astropy Quantities for astrophysical calculations</a></p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this tutorial, we will use the examples of the Planck function and the stellar initial mass function (IMF) to illustrate how to integrate numerically, using the trapezoidal approximation and Gaussian quadrature. We will also explore making a custom class, an instance of which is callable in the same way as a function. In addition, we will encounter <code class="docutils literal notranslate"><span class="pre">astropy</span></code>’s built-in units, and get a first taste of how to convert between them. Finally, we will use <span class="math notranslate nohighlight">\(\LaTeX\)</span> to make our figure axis labels easy to read.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.modeling.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlackBody</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-planck-function">
<h2>The Planck function<a class="headerlink" href="#the-planck-function" title="Link to this heading">#</a></h2>
<p>The Planck function describes how a black-body radiates energy. We will explore how to find bolometric luminosity using the Planck function in both frequency and wavelength space.</p>
<p>Let’s say we have a black-body at 5000 Kelvin. We can find out the total intensity (bolometric) from this object, by integrating the Planck function. The simplest way to do this is by approximating the integral using the trapezoid rule. Let’s do this first using the frequency definition of the Planck function.</p>
<p>We’ll define a photon frequency grid, and evaluate the Planck function at those frequencies. Those will be used to numerically integrate using the trapezoidal rule. By multiplying a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array by an <code class="docutils literal notranslate"><span class="pre">astropy</span></code> unit, we get a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>, which is effectively a combination of one or more numbers and a unit.</p>
<div class="alert alert-info">
**Note on printing units**: 
<p>Quantities and units can be printed to strings using the <a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">Format String Syntax</a>. This demonstration uses the <code class="docutils literal notranslate"><span class="pre">latex_inline</span></code> format that is built in to the <code class="docutils literal notranslate"><span class="pre">astropy.units</span></code> package. To see additional ways to format quantities, see the <a class="reference external" href="http://docs.astropy.org/en/stable/units/#getting-started">Getting Started</a> section of the astropy.units documentation pages.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bb</span> <span class="o">=</span> <span class="n">BlackBody</span><span class="p">(</span><span class="mf">5000.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Kelvin</span><span class="p">)</span>

<span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3000.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">THz</span>
<span class="n">bb5000K_nu</span> <span class="o">=</span> <span class="n">bb</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">bb5000K_nu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\nu$, [{0:latex_inline}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$I_{\nu}$, &quot;</span> <span class="o">+</span> <span class="s2">&quot;[{0:latex_inline}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bb5000K_nu</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Planck function in frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e02ffe815319ef4c4e70c473ca83180c8a4a2067af1a6700892eab5d23ff78c8.png" src="_images/e02ffe815319ef4c4e70c473ca83180c8a4a2067af1a6700892eab5d23ff78c8.png" />
</div>
</div>
<section id="using-latex-for-axis-labels">
<h3>Using <span class="math notranslate nohighlight">\(LaTeX\)</span> for axis labels<a class="headerlink" href="#using-latex-for-axis-labels" title="Link to this heading">#</a></h3>
<p>Here, we’ve used <span class="math notranslate nohighlight">\(LaTeX\)</span> markup to add nice-looking axis labels. To do that, we enclose <span class="math notranslate nohighlight">\(LaTeX\)</span> markup text in dollar signs, within a string <code class="docutils literal notranslate"><span class="pre">r'\$</span> <span class="pre">...</span> <span class="pre">\$'</span></code>. The <code class="docutils literal notranslate"><span class="pre">r</span></code> before the open-quote denotes that the string is “raw,” and backslashes are treated literally. This is the suggested format for axis label text that includes markup.</p>
<p>Now we numerically integrate using the trapezoid rule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bb5000K_nu</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;erg s-1 cm-2 sr-1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3559/2859997087.py:1: DeprecationWarning: `trapz` is deprecated. Use `trapezoid` instead, or one of the numerical integration functions in `scipy.integrate`.
  np.trapz(x=nu, y=bb5000K_nu).to(&quot;erg s-1 cm-2 sr-1&quot;)
</pre></div>
</div>
<div class="output text_latex math notranslate nohighlight">
\[1.1280849 \times 10^{10} \; \mathrm{\frac{erg}{s\,sr\,cm^{2}}}\]</div>
</div>
</div>
<p>Now we can do something similar, but for a wavelength grid. We want to integrate over an equivalent wavelength range to the frequency range we did earlier. We can transform the maximum frequency into the corresponding (minimum) wavelength by using the <code class="docutils literal notranslate"><span class="pre">.to()</span></code> method, with the addition of an <em>equivalency</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">nu</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()),</span>
    <span class="n">nu</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()),</span>
    <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">bb_lam</span> <span class="o">=</span> <span class="n">BlackBody</span><span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="p">))</span>
<span class="n">bb5000K_lam</span> <span class="o">=</span> <span class="n">bb_lam</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">bb5000K_lam</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1.0e3</span><span class="p">,</span> <span class="mf">5.0e4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\lambda$, [{0:latex_inline}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lam</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$I_{\lambda}$, &quot;</span> <span class="o">+</span> <span class="s2">&quot;[{0:latex_inline}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bb5000K_lam</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Planck function in wavelength&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d7108d85911e2e60ba799b5a9b1ca242fbdae7f30dd5a79975ce9cc383e42797.png" src="_images/d7108d85911e2e60ba799b5a9b1ca242fbdae7f30dd5a79975ce9cc383e42797.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bb5000K_lam</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;erg s-1 cm-2 sr-1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3559/3505446155.py:1: DeprecationWarning: `trapz` is deprecated. Use `trapezoid` instead, or one of the numerical integration functions in `scipy.integrate`.
  np.trapz(x=lam, y=bb5000K_lam).to(&quot;erg s-1 cm-2 sr-1&quot;)
</pre></div>
</div>
<div class="output text_latex math notranslate nohighlight">
\[1.146776 \times 10^{10} \; \mathrm{\frac{erg}{s\,sr\,cm^{2}}}\]</div>
</div>
</div>
<p>Notice this is within a couple percent of the answer we got in frequency space, despite our bad sampling at small wavelengths!</p>
<p>Many <code class="docutils literal notranslate"><span class="pre">astropy</span></code> functions use units and quantities directly. As you gain confidence working with them, consider incorporating them into your regular workflow. Read more <a class="reference external" href="http://docs.astropy.org/en/stable/units/">here</a> about how to use units.</p>
</section>
<section id="how-to-simulate-actual-observations">
<h3>How to simulate actual observations<a class="headerlink" href="#how-to-simulate-actual-observations" title="Link to this heading">#</a></h3>
<p>As of Fall 2017, <code class="docutils literal notranslate"><span class="pre">astropy</span></code> does not explicitly support constructing synthetic observations of models like black-body curves. The <a class="reference external" href="https://synphot.readthedocs.io/en/latest/">synphot library</a> does allow this. You can use <code class="docutils literal notranslate"><span class="pre">synphot</span></code> to perform tasks like turning spectra into visual magnitudes by convolving with a filter curve.</p>
</section>
</section>
<section id="the-stellar-initial-mass-function-imf">
<h2>The stellar initial mass function (IMF)<a class="headerlink" href="#the-stellar-initial-mass-function-imf" title="Link to this heading">#</a></h2>
<p>The stellar initial mass function tells us how many of each mass of stars are formed. In particular, low-mass stars are much more abundant than high-mass stars are. Let’s explore more of the functionality of <code class="docutils literal notranslate"><span class="pre">astropy</span></code> using this concept.</p>
<p>People generally think of the IMF as a power-law probability density function. In other words, if you count the stars that have been born recently from a cloud of gas, their distribution of masses will follow the IMF. Let’s write a little class to help us keep track of that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PowerLawPDF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>
</pre></div>
</div>
</div>
</div>
<section id="the-call-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method<a class="headerlink" href="#the-call-method" title="Link to this heading">#</a></h3>
<p>By defining the method <code class="docutils literal notranslate"><span class="pre">__call__</span></code>, we are telling the Python interpreter that an instance of the class can be called like a function. When called, an instance of this class, takes a single argument, <code class="docutils literal notranslate"><span class="pre">x</span></code>, but it uses other attributes of the instance, like <code class="docutils literal notranslate"><span class="pre">gamma</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
</section>
<section id="more-about-classes">
<h3>More about classes<a class="headerlink" href="#more-about-classes" title="Link to this heading">#</a></h3>
<p>Classes are more advanced data structures, which can help you keep track of functionality within your code that all works together. You can learn more about classes in <a class="reference external" href="https://www.codecademy.com/ja/courses/learn-python/lessons/introduction-to-classes/exercises/why-use-classes">this tutorial</a>.</p>
</section>
</section>
<section id="integrating-using-gaussian-quadrature">
<h2>Integrating using Gaussian quadrature<a class="headerlink" href="#integrating-using-gaussian-quadrature" title="Link to this heading">#</a></h2>
<p>In this section, we’ll explore a method of numerical integration that does not require having your sampling grid set-up already. <code class="docutils literal notranslate"><span class="pre">scipy.integrate.quad</span></code> with reference <a class="reference external" href="https://docs.scipy.org/doc/scipy-0.19.1/reference/generated/scipy.integrate.quad.html">here</a> takes a function and both a lower and upper bound, and our <code class="docutils literal notranslate"><span class="pre">PowerLawPDF</span></code> class takes care of this just fine.</p>
<p>Now we can use our new class to normalize our IMF given the mass bounds. This amounts to normalizing a probability density function. We’ll use Gaussian quadrature (<code class="docutils literal notranslate"><span class="pre">quad</span></code>) to find the integral. <code class="docutils literal notranslate"><span class="pre">quad</span></code> returns the numerical value of the integral and its uncertainty. We only care about the numerical value, so we’ll pack the uncertainty into <code class="docutils literal notranslate"><span class="pre">_</span></code> (a placeholder variable). We immediately throw the integral into our IMF object and use it for normalizing!</p>
<p>To read more about <em>generalized packing and unpacking</em> in Python, look at the original proposal, <a class="reference external" href="https://www.python.org/dev/peps/pep-0448/">PEP 448</a>, which was accepted in 2015.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">salpeter</span> <span class="o">=</span> <span class="n">PowerLawPDF</span><span class="p">(</span><span class="n">gamma</span><span class="o">=-</span><span class="mf">2.35</span><span class="p">)</span>
<span class="n">salpeter</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">salpeter</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>

<span class="n">m_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">m_grid</span><span class="p">,</span> <span class="n">salpeter</span><span class="p">(</span><span class="n">m_grid</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Stellar mass [$M_{\odot}$]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability density&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f423a0eca672918d7d8a6121a9cf168105c628b945d40ac6b3bb16a32020798a.png" src="_images/f423a0eca672918d7d8a6121a9cf168105c628b945d40ac6b3bb16a32020798a.png" />
</div>
</div>
<section id="how-many-more-m-stars-are-there-than-o-stars">
<h3>How many more M stars are there than O stars?<a class="headerlink" href="#how-many-more-m-stars-are-there-than-o-stars" title="Link to this heading">#</a></h3>
<p>Let’s compare the number of M dwarf stars (mass less than 60% solar) created by the IMF, to the number of O stars (mass more than 15 times solar).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">salpeter</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">n_o</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">salpeter</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_m</span> <span class="o">/</span> <span class="n">n_o</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20936.017868337385
</pre></div>
</div>
</div>
</div>
<p>There are almost 21000 as many low-mass stars born as there are high-mass stars!</p>
</section>
<section id="where-is-all-the-mass">
<h3>Where is all the mass?<a class="headerlink" href="#where-is-all-the-mass" title="Link to this heading">#</a></h3>
<p>Now let’s compute the relative total masses for all O stars and all M stars born. To do this, weight the Salpeter IMF by mass (i.e., add an extra factor of mass to the integral). To do this, we define a new function that takes the old power-law IMF as one of its arguments. Since this argument is unchanged throughout the integral, it is passed into the tuple <code class="docutils literal notranslate"><span class="pre">args</span></code> within <code class="docutils literal notranslate"><span class="pre">quad</span></code>. It’s important that there is only <em>one</em> argument that changes over the integral, and that it is the <em>first</em> argument that the function being integrated accepts.</p>
<p>Mathematically, the integral for the M stars is</p>
<div class="math notranslate nohighlight">
\[ m^M = \int_{.01 \, M_{\odot}}^{.6 \, M_{\odot}} m \, {\rm IMF}(m) \, dm \]</div>
<p>and it amounts to weighting the probability density function (the IMF) by mass. More generally, you find the value of some property <span class="math notranslate nohighlight">\(\rho\)</span> that depends on <span class="math notranslate nohighlight">\(m\)</span> by calculating</p>
<div class="math notranslate nohighlight">
\[ \rho(m)^M = \int_{.01 \, M_{\odot}}^{.6 \, M_{\odot}} \rho(m) \, {\rm IMF}(m) \, dm \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">IMF_m</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">imf</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">imf</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span>


<span class="n">m_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">IMF_m</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">salpeter</span><span class="p">,))</span>
<span class="n">m_o</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">IMF_m</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">salpeter</span><span class="p">,))</span>

<span class="n">m_m</span> <span class="o">/</span> <span class="n">m_o</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20.29197629920483
</pre></div>
</div>
</div>
</div>
<p>So about 20 times as much mass is tied up in M stars as in O stars.</p>
</section>
<section id="extras">
<h3>Extras<a class="headerlink" href="#extras" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Now compare the total luminosity from all O stars to total luminosity from all M stars. This requires a mass-luminosity relation, like this one which you will use as <span class="math notranslate nohighlight">\(\rho(m)\)</span>:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
 \frac{L}{L_{\odot}} (M) =
  \begin{cases} 
      \hfill .23 \left( \frac{M}{M_{\odot}} \right)^{2.3} \hfill , \hfill &amp; .1 &lt; \frac{M}{M_{\odot}} &lt; .43 \\
      \hfill \left( \frac{M}{M_{\odot}} \right)^{4} \hfill , \hfill &amp; .43 &lt; \frac{M}{M_{\odot}} &lt; 2 \\
      \hfill 1.5 \left( \frac{M}{M_{\odot}} \right)^{3.5} \hfill , \hfill &amp; 2 &lt; \frac{M}{M_{\odot}} &lt; 20 \\
      \hfill 3200 \left( \frac{M}{M_{\odot}} \right) \hfill , \hfill &amp; 20 &lt; \frac{M}{M_{\odot}} &lt; 100 \\
  \end{cases},
\end{split}\]</div>
<ul class="simple">
<li><p>Think about which stars are producing most of the light, and which stars have most of the mass. How might this result in difficulty inferring stellar masses from the light they produce? If you’re interested in learning more, see <a class="reference external" href="https://ned.ipac.caltech.edu/level5/Sept14/Courteau/Courteau_contents.html">this review article</a>.</p></li>
</ul>
</section>
</section>
<section id="challenge-problems">
<h2>Challenge problems<a class="headerlink" href="#challenge-problems" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Right now, we aren’t worried about the bounds of the power law, but the IMF should drop off to zero probability at masses below .01 solar masses and above 100 solar masses. Modify <code class="docutils literal notranslate"><span class="pre">PowerLawPDF</span></code> in a way that allows both <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> inputs.</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">PowerLawPDF</span></code> class to explicitly use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>’s <code class="docutils literal notranslate"><span class="pre">units</span></code> constructs.</p></li>
<li><p>Derive a relationship between recent star-formation rate and <span class="math notranslate nohighlight">\(H\alpha\)</span> luminosity. In other words, find a value of <span class="math notranslate nohighlight">\(C\)</span> for the function</p></li>
</ul>
<div class="math notranslate nohighlight">
\[{\rm SFR \, [\frac{M_{\odot}}{yr}]} = {\rm C \, L_{H\alpha} \, [\frac{erg}{s}]} \, .\]</div>
<ul class="simple">
<li><p>How does this depend on the slope and endpoints of the IMF?</p></li>
<li><p>Take a look at Appendix B of <a class="reference external" href="http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:astro-ph/0408229">Hunter &amp; Elmegreen 2004, AJ, 128, 2170</a></p></li>
<li><p>What effect does changing the power-law index or upper mass limit of the IMF have on the value of <span class="math notranslate nohighlight">\(C\)</span>?</p></li>
<li><p>Predict the effect on the value of <span class="math notranslate nohighlight">\(C\)</span> of using a different form of the IMF, like Kroupa or Chabrier (both are lighter on the low-mass end).</p></li>
<li><p>If you’re not tired of IMFs yet, try defining a new class that implements a broken-power-law (Kroupa) or log-parabola (Chabrier) IMF. Perform the same calculations as above.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "astropy-learn/tutorial--units-and-integration",
            ref: "main/",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By AUTHOR1 (@GITHUB-USERNAME, ORCID-ID), AUTHOR2 (@GITHUB-USERNAME, ORCID-ID)
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>